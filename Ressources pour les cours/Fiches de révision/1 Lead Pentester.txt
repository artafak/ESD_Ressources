principal risque pour une entreprise : impact financier
principes de la sécurité de l'information : Techniques, organisationnel, humains, juridique
ensemble de moyens pour sécuriser les données et services portés par un SI
confidentialité, intégrité, disponibilité, authenticité, traçabilité
triangle de la sécurité : fonctionnalité, sécurité, ergonomie
politiques, physique, périmètre, réseau, hote, application, data
PSSI : Prévention, détection, dissuasion, récupération, compensation
hack value : cible de valeur
daisy chaining : réuse de logins vers d'autres systèmes
doxing : publications d'infos nominatives à partir de données publiques ou réseaux sociaux
ROE : règles d'engagement
Worst plan : plan de secours
Droper : code, commande téléchargeant un fichier malveillant
Exploit : code, requête permettant d'exploiter la vuln
payload : code malicieux visant à accomplir une action
test d'intrusion : méthode d'évaluation de la sécurité d'un système ou réseau 
phases d'un test d'intrusion : Reconnaissance, Enumération, Exploitation, Post-exploitation
Loi GODFRAIN Article 323-1
	Confidentialité des auditeurs
	remontée aux autorités les infractions relevées par le test 
	usurpation d'identité : consentement nécessaire
	l'auditeur ne doit pas voler d'infos et doit détruire les échantillons
Méthodologies/framework : OWASP, PTES, OSSTMM, MITRE-ATTACK
Cadrage : réunion de lancement, proposition commerciale, rédaction ROE, brainstorming, préparatifs inter
périmètre : contrat ROE 
TCP Headers, flags : URG, ACK, PSH, RST, SYN, FIN
nmap -sT (full open scan)
nmap -sS (half open scan)
nmap -sN (null scan)
nmap -sX (xmas scan)
TCP ACK Scan : vérification filtrage actif
nmap -sV (banner grabbing - versions)
TTL 64 : Linux / TTL 128 : Windows
showmount : énumérer les exports NFS d'un serveur distant
CVE (identification vuln) /CVSS (score de gravité)
HeartBleed : OpenSSL (information leak)
DirtyCow : noyaux Linux (Local Code Execution)
EternalBlue : SMB v1 et v2 (Remote Code Execution)
Metasploits, modules : Auxiliary, Exploits, Payloads, Post, Encoders, Nops, Evasion
Reverse shell, passer en TTY : python -c 'import pty; pty.spawn("/bin/bash")'
bruteforce : attaque incrémentale, par dictionnaire, par rainbow-tables
CeWL : outil pour créer wordlist avant bruteforce
password spraying : tester 1 mdp pour X users : pas de blocage (délai)

---------

Cyberkill chain : reconnaissance, weaponization, delivery, exploitation, installation, command & control, actions on objectives
Dropper : programme déclencheur visant à télécharger et exécuter le code malicieux 
file-less : code malveillant chargé en mémoire : aucun fichier sur le disque (Powershell : IEX)
Bind-shell : ouvre un port sur la machine infectée, attente d'une connexion de l'attaquant. Inconvénients : firewall, NAT
Reverse-shell : l'hôte infecté établi une connexion vers l'attaquant (listener)
charge 	staged : windows/meterpreter/reverse_tcp
			Envoyée en plusieurs parties (1ère légère, la deuxième permet le chiffrement et envoi les dll...) contourne les détections
		stageless : windows/meterpreter_reverse_tcp
			envoyée en 1 seule fois : firewall/IDS ont plus de mal à détecter 
		single : windows /adduser
		
stager : établi un canal de comm et exécute des "stage". stage = action 
msfvenom : génération de charge utilisant plusieurs payloads
	modules : payload, encoders, nops (assembleur), platforms, archs, encrypts, formats (exe, dll...)
Macro = VBA (visual Basic for Applications)
		dans Office, différentes fonctions Sub permettent la compatibilité des différentes versions d'Office 
		Obfuscation : Chr (ascii -> char), Asc (char->ascii), StrReverse (inversion de chaîne)
	génération de macros piégées : metasploit, Vbad, Unicorn, Empire
	DDE (Dynamic Data Exchange) - fonctionnalité d'intégration de contenu externe dans Office --> POPUP avertissement !
	
LOLBAS : binaires signés détournés pour effectuer des actions malveillantes (ex : certutil)
LOLBAS : bitsadmin, mshta, hh, ilasm, rundll32, curl 
PowerShell : Invoke-Expression -> télécharge et exécute du code en mémoire
Automatisation de Metasploit avec des scripts.RC  --> fonction AutoRunScript

Gophish : framework pour campagnes de phishing (nécessite postfix)
Enregistrement SPF : Norme identifier les serveurs autorisés des mails pour un nom de domaine (enregistrement TXT/DNS)
	SPF non actif = risques d'usurpation d'identité, vol de réputation numérique ATTENTION AU TILD ~ !!
DMARC : protocole vérifiant les champs "from" et "mailfrom" + catégorisation mail (spam, ...)

------
Protocoles d'authent : Kerberos et NTLM
Kerberos plus robuste, utilise le FQDN (TOTO.LOCAL.FR)
NTLM pour la compatibilité, utilise l'IP/nom court X.X.X.X
LM HASH : condensat de mot de passe (désactivé depuis Vista)
NT HASH : condensat de mdp sur les systèmes modernes --> MD4 du mdp 
LM et NT HASHS sont dans SAM, NTDS ou LSASS (dernière colonne. 404EE = désactivé !)
Possibilité de les bruteforcer OU pass-the-hash
NTLM et Net-NTLM = protocole DEFI/REPONSE
	Protocole NTLMSSP = 3 phases : negotiate, challenge, auth 
Supporté par de nombreux protocoles (SMB, LDAP, HTTP, IMAP, SMTP, MS-SQL)
	BRUTEFORCE OU RELAY NTLM 
Résolution de nom Microsoft : hosts, cache DNS local, DNS système, NetBIOS (boradcast), LLMNR (multicast)
LLMNR (Link-Local Multicast Name Resolution)  UDP 5355
NBT-NS (Netbios Name Service)  UDP 137
OUTIL D'ATTAQUE : RESPONDER/MULTIRELAY
ATTAQUE WPAD Web Proxy Auto-Discovery Protocol (conf proxy auto)

-------
KERBEROS -> Authentication Authorization Accounting
tiers de confiance : KDC (Key Distribution Center) Chiffrement symétrique + gestion/distrib de clés
KDC : AS (Authentication Service) + TGS (Ticket-Granting Service)
AS -> ticket TGT nécessaire pour obtenir des TGS
TGS vérifie l'authenticité des demandes et génère des tickets d'accès 

ATTAQUE AS_REP Roasting : Demande PRE_AUTH -> Récupère le hash Kerberos 
(pré-authent kerberos n'est pas nécessaire) --> Compatibilité = FAILLE

ATTAQUE KERBEROASTING : demande de TGS à travers un compte de service pour casser le hash 